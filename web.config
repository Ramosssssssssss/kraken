<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <rewrite>
      <rules>

        <!-- 1) En el dominio raíz (krkn.mx), /login debe ir al landing "/" -->
        <rule name="RootDomainLoginToRoot" enabled="true" stopProcessing="true">
          <!-- Coincide exactamente /login o /login/ -->
          <match url="^login/?$" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="^(?:www\.)?krkn\.mx$" ignoreCase="true" />
          </conditions>
          <action type="Redirect" url="http://krkn.mx/" redirectType="Found" />
        </rule>

        <!-- 2) En subdominios, si piden la raíz "/", redirigir a /login -->
        <rule name="SubdomainRootToLogin" enabled="true" stopProcessing="true">
          <match url="^$" />
          <conditions logicalGrouping="MatchAll">
            <!-- Cualquier *.krkn.mx excepto el dominio raíz -->
            <add input="{HTTP_HOST}" pattern="^(?!krkn\.mx$)([a-z0-9-]+)\.krkn\.mx$" ignoreCase="true" />
          </conditions>
          <action type="Redirect" url="http://{HTTP_HOST}/login" redirectType="Found" />
        </rule>

        <!-- 3) Proxy hacia tu app Node -->
        <rule name="ReverseProxyInboundRule1" stopProcessing="true">
          <match url="(.*)" />
          <action type="Rewrite" url="http://localhost:3003/{R:1}" />
        </rule>

      </rules>
    </rewrite>
  </system.webServer>
</configuration>
